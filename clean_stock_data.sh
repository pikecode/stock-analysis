#!/bin/bash
# ============================================================================
# 清理股票数据脚本
# ============================================================================
# 用途: 快速清空数据库中的所有股票相关数据
# 使用: bash clean_stock_data.sh
# 或:   ./clean_stock_data.sh
# ============================================================================

set -e  # 遇到错误立即退出

# 配置
DB_USER="${DB_USER:-peak}"
DB_NAME="${DB_NAME:-stock_analysis}"
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SQL_FILE="$SCRIPT_DIR/clean_stock_data.sql"

echo "============================================================================"
echo "股票数据清理脚本"
echo "============================================================================"
echo ""
echo "配置信息:"
echo "  数据库用户: $DB_USER"
echo "  数据库名: $DB_NAME"
echo ""

# 确认用户操作
read -p "确定要清空所有股票相关数据吗? (y/n) " -n 1 -r
echo ""
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "已取消操作"
    exit 1
fi

echo ""
echo "正在执行清理脚本..."
echo ""

# 执行 SQL 脚本
psql -U "$DB_USER" -d "$DB_NAME" -f "$SQL_FILE"

echo ""
echo "============================================================================"
echo "清理完成！"
echo "============================================================================"
