# 详细任务分解

**最后更新**: 2025-11-23

---

## 任务状态说明

| 状态 | 符号 | 说明 |
|-----|------|------|
| 待开始 | ⏳ | 尚未开始 |
| 进行中 | 🔄 | 正在进行 |
| 已完成 | ✅ | 已完成 |
| 阻塞 | 🚫 | 被阻塞 |

---

## M1: 基础架构

### 1.1 后端项目初始化

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 1.1.1 | 创建项目目录结构 | backend/app/api,models,services,repositories | ⏳ |
| 1.1.2 | 配置FastAPI入口 | main.py, 路由配置 | ⏳ |
| 1.1.3 | 配置数据库连接 | SQLAlchemy + database.py | ⏳ |
| 1.1.4 | 配置Redis连接 | redis-py配置 | ⏳ |
| 1.1.5 | 配置Celery | tasks/celery_app.py | ⏳ |
| 1.1.6 | 配置日志 | logging配置 | ⏳ |
| 1.1.7 | 创建requirements.txt | 依赖列表 | ⏳ |
| 1.1.8 | 创建.env.example | 配置模板 | ⏳ |

### 1.2 数据库初始化

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 1.2.1 | 执行init_tables.sql | 创建所有表 | ⏳ |
| 1.2.2 | 创建SQLAlchemy Models | models/*.py | ⏳ |
| 1.2.3 | 配置Alembic | 数据库迁移 | ⏳ |
| 1.2.4 | 添加初始数据 | 指标类型、角色等 | ⏳ |

### 1.3 用户认证

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 1.3.1 | User模型 | models/user.py | ⏳ |
| 1.3.2 | JWT工具类 | utils/jwt.py | ⏳ |
| 1.3.3 | 密码加密 | utils/password.py | ⏳ |
| 1.3.4 | 登录接口 | POST /auth/login | ⏳ |
| 1.3.5 | Token刷新 | POST /auth/refresh | ⏳ |
| 1.3.6 | 认证中间件 | 依赖注入 | ⏳ |
| 1.3.7 | 权限检查 | RBAC实现 | ⏳ |

### 1.4 前端项目初始化

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 1.4.1 | 创建Vue项目 | vite create | ⏳ |
| 1.4.2 | 配置TypeScript | tsconfig.json | ⏳ |
| 1.4.3 | 配置路由 | Vue Router | ⏳ |
| 1.4.4 | 配置状态管理 | Pinia | ⏳ |
| 1.4.5 | 配置UI组件库 | Element Plus | ⏳ |
| 1.4.6 | 配置HTTP客户端 | Axios封装 | ⏳ |
| 1.4.7 | 登录页面 | views/Login.vue | ⏳ |
| 1.4.8 | 布局组件 | layouts/MainLayout.vue | ⏳ |

### 1.5 Docker配置

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 1.5.1 | 后端Dockerfile | backend/Dockerfile | ⏳ |
| 1.5.2 | 前端Dockerfile | frontend/Dockerfile | ⏳ |
| 1.5.3 | docker-compose.yml | 服务编排 | ⏳ |
| 1.5.4 | Nginx配置 | nginx.conf | ⏳ |

---

## M2: 数据导入

### 2.1 文件上传

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 2.1.1 | 上传接口 | POST /import/upload | ⏳ |
| 2.1.2 | 文件存储 | MinIO/本地存储 | ⏳ |
| 2.1.3 | 文件类型识别 | CSV/TXT自动识别 | ⏳ |
| 2.1.4 | 创建导入批次 | import_batches记录 | ⏳ |

### 2.2 CSV解析

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 2.2.1 | CSV解析器 | pandas读取 | ⏳ |
| 2.2.2 | 字段映射 | 股票/概念/行业 | ⏳ |
| 2.2.3 | 数据校验 | 必填/格式检查 | ⏳ |
| 2.2.4 | 存入raw表 | stock_concept_mapping_raw | ⏳ |
| 2.2.5 | 同步主数据 | stocks/concepts/stock_concepts | ⏳ |

### 2.3 TXT解析

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 2.3.1 | TXT解析器 | 逐行解析 | ⏳ |
| 2.3.2 | 前缀分离 | SH/SZ/BJ提取 | ⏳ |
| 2.3.3 | 指标类型识别 | 文件名匹配 | ⏳ |
| 2.3.4 | 数据校验 | 格式/数值检查 | ⏳ |
| 2.3.5 | 存入raw表 | stock_metric_data_raw | ⏳ |
| 2.3.6 | 同步股票信息 | 新股票自动创建 | ⏳ |

### 2.4 计算任务

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 2.4.1 | 排名计算任务 | Celery task | ⏳ |
| 2.4.2 | 排名SQL实现 | DENSE_RANK窗口函数 | ⏳ |
| 2.4.3 | 汇总计算任务 | Celery task | ⏳ |
| 2.4.4 | 汇总SQL实现 | SUM/AVG/MAX/MIN | ⏳ |
| 2.4.5 | 任务链 | 导入→计算→完成 | ⏳ |

### 2.5 进度推送

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 2.5.1 | WebSocket端点 | /ws/import/{batch_id} | ⏳ |
| 2.5.2 | 进度更新 | 解析/计算进度 | ⏳ |
| 2.5.3 | 前端进度组件 | 进度条展示 | ⏳ |

### 2.6 导入管理界面

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 2.6.1 | 文件上传组件 | 拖拽上传 | ⏳ |
| 2.6.2 | 导入配置表单 | 指标类型/日期 | ⏳ |
| 2.6.3 | 导入历史列表 | 批次记录展示 | ⏳ |
| 2.6.4 | 导入详情页 | 错误日志查看 | ⏳ |

---

## M3: 查询功能

### 3.1 股票查询

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 3.1.1 | 股票列表API | GET /stocks | ⏳ |
| 3.1.2 | 股票详情API | GET /stocks/{code} | ⏳ |
| 3.1.3 | 股票概念API | GET /stocks/{code}/concepts | ⏳ |
| 3.1.4 | Repository层 | StockRepository | ⏳ |
| 3.1.5 | Service层 | StockService | ⏳ |

### 3.2 概念查询

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 3.2.1 | 概念列表API | GET /concepts | ⏳ |
| 3.2.2 | 概念详情API | GET /concepts/{id} | ⏳ |
| 3.2.3 | 概念股票API | GET /concepts/{id}/stocks | ⏳ |

### 3.3 排名查询

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 3.3.1 | 概念排名列表 | GET /rankings/concept/{id} | ⏳ |
| 3.3.2 | 股票排名历史 | GET /rankings/stock/{code} | ⏳ |
| 3.3.3 | 前N名统计 | GET /rankings/stock/{code}/top-n-count | ⏳ |

### 3.4 汇总查询

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 3.4.1 | 概念日汇总 | GET /summaries/concept/{id} | ⏳ |
| 3.4.2 | 多指标对比 | GET /summaries/concept/{id}/compare | ⏳ |

---

## M4: 前端开发

### 4.1 页面开发

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 4.1.1 | 首页/Dashboard | 数据概览 | ⏳ |
| 4.1.2 | 股票列表页 | 搜索+列表 | ⏳ |
| 4.1.3 | 股票详情页 | 概念+排名 | ⏳ |
| 4.1.4 | 概念列表页 | 浏览概念 | ⏳ |
| 4.1.5 | 概念详情页 | 股票+汇总 | ⏳ |
| 4.1.6 | 排名榜单页 | 日排名 | ⏳ |
| 4.1.7 | 统计分析页 | 前N名统计 | ⏳ |

### 4.2 图表组件

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 4.2.1 | ECharts集成 | 安装配置 | ⏳ |
| 4.2.2 | 排名趋势图 | 折线图 | ⏳ |
| 4.2.3 | 交易量柱状图 | 柱状图 | ⏳ |
| 4.2.4 | 多指标对比图 | 组合图 | ⏳ |

### 4.3 后台管理

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 4.3.1 | 用户管理页 | CRUD | ⏳ |
| 4.3.2 | 角色管理页 | 权限配置 | ⏳ |
| 4.3.3 | 指标管理页 | 指标类型 | ⏳ |
| 4.3.4 | 操作日志页 | 审计日志 | ⏳ |

---

## M5: 优化上线

### 5.1 性能优化

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 5.1.1 | 数据库优化 | 索引分析 | ⏳ |
| 5.1.2 | 缓存优化 | Redis策略 | ⏳ |
| 5.1.3 | 压力测试 | JMeter/Locust | ⏳ |
| 5.1.4 | 慢查询优化 | EXPLAIN分析 | ⏳ |

### 5.2 安全加固

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 5.2.1 | SQL注入检查 | 代码审计 | ⏳ |
| 5.2.2 | XSS检查 | 输入过滤 | ⏳ |
| 5.2.3 | 权限检查 | API权限 | ⏳ |
| 5.2.4 | 密钥管理 | 配置加密 | ⏳ |

### 5.3 部署配置

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 5.3.1 | 生产配置 | .env.production | ⏳ |
| 5.3.2 | Nginx配置 | 生产环境 | ⏳ |
| 5.3.3 | 数据库备份 | 定时备份 | ⏳ |
| 5.3.4 | 日志管理 | 日志轮转 | ⏳ |

### 5.4 监控告警

| ID | 任务 | 描述 | 状态 |
|----|-----|------|------|
| 5.4.1 | 健康检查 | /health接口 | ⏳ |
| 5.4.2 | 指标采集 | Prometheus | ⏳ |
| 5.4.3 | 仪表盘 | Grafana | ⏳ |
| 5.4.4 | 告警配置 | AlertManager | ⏳ |
